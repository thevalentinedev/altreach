"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/twitter/generate-comments/route";
exports.ids = ["app/api/twitter/generate-comments/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&page=%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute.ts&appDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&page=%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute.ts&appDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_valentinedev_Downloads_altreach_session_app_api_twitter_generate_comments_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/twitter/generate-comments/route.ts */ \"(rsc)/./app/api/twitter/generate-comments/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/twitter/generate-comments/route\",\n        pathname: \"/api/twitter/generate-comments\",\n        filename: \"route\",\n        bundlePath: \"app/api/twitter/generate-comments/route\"\n    },\n    resolvedPagePath: \"/home/valentinedev/Downloads/altreach-session/app/api/twitter/generate-comments/route.ts\",\n    nextConfigOutput,\n    userland: _home_valentinedev_Downloads_altreach_session_app_api_twitter_generate_comments_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/twitter/generate-comments/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ0d2l0dGVyJTJGZ2VuZXJhdGUtY29tbWVudHMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnR3aXR0ZXIlMkZnZW5lcmF0ZS1jb21tZW50cyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnR3aXR0ZXIlMkZnZW5lcmF0ZS1jb21tZW50cyUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGdmFsZW50aW5lZGV2JTJGRG93bmxvYWRzJTJGYWx0cmVhY2gtc2Vzc2lvbiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGaG9tZSUyRnZhbGVudGluZWRldiUyRkRvd25sb2FkcyUyRmFsdHJlYWNoLXNlc3Npb24maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3dDO0FBQ3JIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8/MTZmNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvaG9tZS92YWxlbnRpbmVkZXYvRG93bmxvYWRzL2FsdHJlYWNoLXNlc3Npb24vYXBwL2FwaS90d2l0dGVyL2dlbmVyYXRlLWNvbW1lbnRzL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90d2l0dGVyL2dlbmVyYXRlLWNvbW1lbnRzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdHdpdHRlci9nZW5lcmF0ZS1jb21tZW50c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvdHdpdHRlci9nZW5lcmF0ZS1jb21tZW50cy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9ob21lL3ZhbGVudGluZWRldi9Eb3dubG9hZHMvYWx0cmVhY2gtc2Vzc2lvbi9hcHAvYXBpL3R3aXR0ZXIvZ2VuZXJhdGUtY29tbWVudHMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3R3aXR0ZXIvZ2VuZXJhdGUtY29tbWVudHMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&page=%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute.ts&appDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/twitter/generate-comments/route.ts":
/*!****************************************************!*\
  !*** ./app/api/twitter/generate-comments/route.ts ***!
  \****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n\n\n// Initialize OpenAI client\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\n// In-memory rate limiter\nconst rateLimitMap = new Map();\nconst RATE_LIMIT_WINDOW = 3000 // 3 seconds in milliseconds\n;\n// Helper function to get client identifier (IP address)\nfunction getClientId(request) {\n    const forwarded = request.headers.get(\"x-forwarded-for\");\n    const realIp = request.headers.get(\"x-real-ip\");\n    const cfConnectingIp = request.headers.get(\"cf-connecting-ip\");\n    const clientIp = forwarded?.split(\",\")[0] || realIp || cfConnectingIp || \"unknown\";\n    return clientIp.trim();\n}\n// Rate limiting function\nfunction checkRateLimit(clientId) {\n    const now = Date.now();\n    const lastRequest = rateLimitMap.get(clientId);\n    if (lastRequest) {\n        const timeSinceLastRequest = now - lastRequest;\n        if (timeSinceLastRequest < RATE_LIMIT_WINDOW) {\n            const timeRemaining = RATE_LIMIT_WINDOW - timeSinceLastRequest;\n            return {\n                allowed: false,\n                timeRemaining\n            };\n        }\n    }\n    rateLimitMap.set(clientId, now);\n    // Clean up old entries to prevent memory leaks\n    for (const [id, timestamp] of rateLimitMap.entries()){\n        if (now - timestamp > 60000) {\n            rateLimitMap.delete(id);\n        }\n    }\n    return {\n        allowed: true\n    };\n}\n// Helper function to determine the appropriate model based on content complexity\nfunction determineOptimalModel(text, isComplexRequest, hasImages = false) {\n    // Always use GPT-4o for image analysis\n    if (hasImages) {\n        console.log(\"Using GPT-4o for image analysis\");\n        return \"gpt-4o\";\n    }\n    // Default to GPT-3.5-turbo for most requests\n    let model = \"gpt-3.5-turbo-1106\";\n    // Check for complexity indicators\n    const isComplex = isComplexRequest || text.length > 500 || text.includes(\"code\") || text.includes(\"technical\") || /\\b(analyze|analyse|explain|compare|contrast)\\b/i.test(text);\n    if (isComplex) {\n        model = \"gpt-4o\" // Use more capable model for complex requests\n        ;\n        console.log(\"Using GPT-4o for complex request\");\n    } else {\n        console.log(\"Using GPT-3.5-turbo for standard request\");\n    }\n    return model;\n}\nasync function POST(request) {\n    try {\n        // Rate limiting check (keep existing code)\n        const clientId = getClientId(request);\n        const rateLimitResult = checkRateLimit(clientId);\n        if (!rateLimitResult.allowed) {\n            const secondsRemaining = Math.ceil((rateLimitResult.timeRemaining || 0) / 1000);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: `Please wait a moment before generating another comment. Try again in ${secondsRemaining} second${secondsRemaining !== 1 ? \"s\" : \"\"}.`,\n                rateLimited: true,\n                retryAfter: secondsRemaining\n            }, {\n                status: 429,\n                headers: {\n                    \"Retry-After\": secondsRemaining.toString()\n                }\n            });\n        }\n        const requestData = await request.json();\n        const { tweetContent, tone, length, useEmoji, variations, instructions } = requestData;\n        if (!tweetContent || !tweetContent.text) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Tweet content is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Validate variations\n        const numVariations = variations || 3;\n        if (numVariations < 1 || numVariations > 5) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Number of variations must be between 1 and 5\"\n            }, {\n                status: 400\n            });\n        }\n        try {\n            // Check if we have images\n            const hasImages = tweetContent.images && tweetContent.images.length > 0;\n            // Build the system prompt\n            const systemPrompt = `You are a social media copywriter specializing in Twitter/X replies. \nGiven a tweet${hasImages ? \" with images\" : \"\"}, first analyze its content to determine the most appropriate tone for a reply, then generate ${numVariations} comment variation${numVariations > 1 ? \"s\" : \"\"} using that tone (unless a specific tone is requested).\n\n${tone ? `The requested tone is: ${tone}` : \"Determine the optimal tone based on the tweet content.\"}\n\nGuidelines:\n- ${tone ? `Use the requested ${tone} tone` : \"First determine the optimal tone, then use it consistently\"}\n- Keep replies ${length === \"shorter\" ? \"concise (under 140 characters)\" : \"more detailed (140-280 characters)\"}\n- ${useEmoji ? \"Include relevant emojis naturally\" : \"Do not use emojis\"}\n- Make each variation distinct and engaging\n- Focus on driving conversation and engagement\n- Sound authentic and human, not generic or AI-generated\n- Avoid generic phrases like \"Great post!\" or \"Thanks for sharing!\"\n- Respond directly to the content of the tweet\n${hasImages ? \"- Consider the visual content in the images when crafting your response\" : \"\"}\n\n${instructions ? `Additional instructions: ${instructions}` : \"\"}\n\nReturn your response as a JSON object with the following structure:\n{\n  \"detectedTone\": \"brief description of the detected tone (only if no tone was specified)\",\n  \"comments\": [\"First comment variation\", \"Second comment variation\", \"Third comment variation\"]\n}\n`;\n            // Create the user prompt with the tweet content\n            const userPrompt = `Tweet${tweetContent.author ? ` by ${tweetContent.author}` : \"\"}:\n\"${tweetContent.text.substring(0, 280)}${tweetContent.text.length > 280 ? \"...\" : \"\"}\"\n\n${tone ? `Generate ${numVariations} ${tone} reply variation${numVariations > 1 ? \"s\" : \"\"}.` : `Determine the best tone for replying, then generate ${numVariations} reply variation${numVariations > 1 ? \"s\" : \"\"} using that tone.`}`;\n            // Determine if this is a complex request\n            const isComplexRequest = !!instructions && (instructions.length > 100 || instructions.includes(\"technical\") || instructions.includes(\"analyze\"));\n            // Determine the optimal model\n            const modelToUse = determineOptimalModel(tweetContent.text, isComplexRequest, hasImages);\n            // Create messages array - handle images if present\n            const messages = [\n                {\n                    role: \"system\",\n                    content: systemPrompt\n                }\n            ];\n            if (hasImages && tweetContent.images) {\n                // Create vision message with images\n                const imageContent = tweetContent.images.map((imageUrl)=>({\n                        type: \"image_url\",\n                        image_url: {\n                            url: imageUrl,\n                            detail: \"low\"\n                        }\n                    }));\n                messages.push({\n                    role: \"user\",\n                    content: [\n                        {\n                            type: \"text\",\n                            text: userPrompt\n                        },\n                        ...imageContent\n                    ]\n                });\n            } else {\n                // Text-only message\n                messages.push({\n                    role: \"user\",\n                    content: userPrompt\n                });\n            }\n            // Call OpenAI API\n            const response = await openai.chat.completions.create({\n                model: modelToUse,\n                messages: messages,\n                temperature: 0.8,\n                response_format: {\n                    type: \"json_object\"\n                },\n                max_tokens: 1000\n            });\n            const content = response.choices[0].message.content;\n            if (!content) {\n                throw new Error(\"No content returned from OpenAI\");\n            }\n            // Parse the JSON response (keep existing parsing logic)\n            let comments = [];\n            let detectedTone = null;\n            try {\n                const parsedResponse = JSON.parse(content);\n                // Extract detected tone if available\n                if (parsedResponse.detectedTone && !tone) {\n                    detectedTone = parsedResponse.detectedTone;\n                }\n                // Handle different possible JSON structures\n                if (Array.isArray(parsedResponse)) {\n                    comments = parsedResponse;\n                } else if (parsedResponse.comments && Array.isArray(parsedResponse.comments)) {\n                    comments = parsedResponse.comments;\n                } else if (parsedResponse.replies && Array.isArray(parsedResponse.replies)) {\n                    comments = parsedResponse.replies;\n                } else if (parsedResponse.variations && Array.isArray(parsedResponse.variations)) {\n                    comments = parsedResponse.variations;\n                } else {\n                    // Try to extract any array property\n                    const arrayProps = Object.values(parsedResponse).filter((val)=>Array.isArray(val));\n                    if (arrayProps.length > 0 && Array.isArray(arrayProps[0])) {\n                        comments = arrayProps[0];\n                    }\n                }\n            } catch (parseError) {\n                console.error(\"Error parsing OpenAI response:\", parseError);\n                // Fallback: try to extract an array from the content\n                const arrayMatch = content.match(/\\[(.*)\\]/s);\n                if (arrayMatch && arrayMatch[1]) {\n                    try {\n                        comments = JSON.parse(`[${arrayMatch[1]}]`);\n                    } catch  {\n                        // If all parsing fails, split by newlines and clean up\n                        comments = content.split(\"\\n\").filter((line)=>line.trim().startsWith('\"') || line.trim().startsWith(\"'\")).map((line)=>line.trim().replace(/^[\"']|[\"'],?$/g, \"\"));\n                    }\n                }\n            }\n            // Ensure we have at least one comment\n            if (!comments.length) {\n                throw new Error(\"Failed to generate comments\");\n            }\n            // Format the comments\n            const formattedComments = comments.map((text, index)=>({\n                    text: text.trim().replace(/^[\"']|[\"']$/g, \"\"),\n                    isRecommended: index === 0\n                }));\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                comments: formattedComments,\n                tweetContext: tweetContent.text,\n                tone: detectedTone || tone,\n                detectedTone: detectedTone,\n                hasImages: hasImages,\n                imageCount: hasImages ? tweetContent.images?.length || 0 : 0,\n                metadata: {\n                    length,\n                    useEmoji,\n                    variations: numVariations,\n                    hasInstructions: !!instructions,\n                    modelUsed: modelToUse\n                }\n            });\n        } catch (openaiError) {\n            console.error(\"OpenAI API error:\", openaiError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to generate comments. Our AI service is experiencing issues. Please try again shortly.\"\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"Error generating comments:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Comment generation failed. Please try again.\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3R3aXR0ZXIvZ2VuZXJhdGUtY29tbWVudHMvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQTBDO0FBQ2Y7QUFFM0IsMkJBQTJCO0FBQzNCLE1BQU1FLFNBQVMsSUFBSUQsOENBQU1BLENBQUM7SUFDeEJFLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0MsY0FBYztBQUNwQztBQUVBLHlCQUF5QjtBQUN6QixNQUFNQyxlQUFlLElBQUlDO0FBQ3pCLE1BQU1DLG9CQUFvQixLQUFLLDRCQUE0Qjs7QUFFM0Qsd0RBQXdEO0FBQ3hELFNBQVNDLFlBQVlDLE9BQWdCO0lBQ25DLE1BQU1DLFlBQVlELFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQ3RDLE1BQU1DLFNBQVNKLFFBQVFFLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDO0lBQ25DLE1BQU1FLGlCQUFpQkwsUUFBUUUsT0FBTyxDQUFDQyxHQUFHLENBQUM7SUFDM0MsTUFBTUcsV0FBV0wsV0FBV00sTUFBTSxJQUFJLENBQUMsRUFBRSxJQUFJSCxVQUFVQyxrQkFBa0I7SUFDekUsT0FBT0MsU0FBU0UsSUFBSTtBQUN0QjtBQUVBLHlCQUF5QjtBQUN6QixTQUFTQyxlQUFlQyxRQUFnQjtJQUN0QyxNQUFNQyxNQUFNQyxLQUFLRCxHQUFHO0lBQ3BCLE1BQU1FLGNBQWNqQixhQUFhTyxHQUFHLENBQUNPO0lBRXJDLElBQUlHLGFBQWE7UUFDZixNQUFNQyx1QkFBdUJILE1BQU1FO1FBQ25DLElBQUlDLHVCQUF1QmhCLG1CQUFtQjtZQUM1QyxNQUFNaUIsZ0JBQWdCakIsb0JBQW9CZ0I7WUFDMUMsT0FBTztnQkFBRUUsU0FBUztnQkFBT0Q7WUFBYztRQUN6QztJQUNGO0lBRUFuQixhQUFhcUIsR0FBRyxDQUFDUCxVQUFVQztJQUUzQiwrQ0FBK0M7SUFDL0MsS0FBSyxNQUFNLENBQUNPLElBQUlDLFVBQVUsSUFBSXZCLGFBQWF3QixPQUFPLEdBQUk7UUFDcEQsSUFBSVQsTUFBTVEsWUFBWSxPQUFP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b0JBQzNFM0UsTUFBTUEsS0FBS2YsSUFBSSxHQUFHd0YsT0FBTyxDQUFDLGdCQUFnQjtvQkFDMUNHLGVBQWVELFVBQVU7Z0JBQzNCO1lBRUEsT0FBTzdHLHFEQUFZQSxDQUFDaUQsSUFBSSxDQUFDO2dCQUN2QndDLFVBQVVtQjtnQkFDVkcsY0FBY3ZELGFBQWF0QixJQUFJO2dCQUMvQnVCLE1BQU1pQyxnQkFBZ0JqQztnQkFDdEJpQyxjQUFjQTtnQkFDZHRELFdBQVdBO2dCQUNYNEUsWUFBWTVFLFlBQVlvQixhQUFhTSxNQUFNLEVBQUVyQixVQUFVLElBQUk7Z0JBQzNEd0UsVUFBVTtvQkFDUnhFO29CQUNBaUI7b0JBQ0FDLFlBQVlFO29CQUNacUQsaUJBQWlCLENBQUMsQ0FBQ3REO29CQUNuQnVELFdBQVdoRDtnQkFDYjtZQUNGO1FBQ0YsRUFBRSxPQUFPaUQsYUFBYTtZQUNwQi9FLFFBQVFhLEtBQUssQ0FBQyxxQkFBcUJrRTtZQUNuQyxPQUFPcEgscURBQVlBLENBQUNpRCxJQUFJLENBQ3RCO2dCQUNFQyxPQUFPO1lBQ1QsR0FDQTtnQkFBRUcsUUFBUTtZQUFJO1FBRWxCO0lBQ0YsRUFBRSxPQUFPSCxPQUFPO1FBQ2RiLFFBQVFhLEtBQUssQ0FBQyw4QkFBOEJBO1FBQzVDLE9BQU9sRCxxREFBWUEsQ0FBQ2lELElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQStDLEdBQUc7WUFBRUcsUUFBUTtRQUFJO0lBQ3BHO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vYXBwL2FwaS90d2l0dGVyL2dlbmVyYXRlLWNvbW1lbnRzL3JvdXRlLnRzPzVkMTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCJcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiXG5cbi8vIEluaXRpYWxpemUgT3BlbkFJIGNsaWVudFxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KVxuXG4vLyBJbi1tZW1vcnkgcmF0ZSBsaW1pdGVyXG5jb25zdCByYXRlTGltaXRNYXAgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpXG5jb25zdCBSQVRFX0xJTUlUX1dJTkRPVyA9IDMwMDAgLy8gMyBzZWNvbmRzIGluIG1pbGxpc2Vjb25kc1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IGNsaWVudCBpZGVudGlmaWVyIChJUCBhZGRyZXNzKVxuZnVuY3Rpb24gZ2V0Q2xpZW50SWQocmVxdWVzdDogUmVxdWVzdCk6IHN0cmluZyB7XG4gIGNvbnN0IGZvcndhcmRlZCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJ4LWZvcndhcmRlZC1mb3JcIilcbiAgY29uc3QgcmVhbElwID0gcmVxdWVzdC5oZWFkZXJzLmdldChcIngtcmVhbC1pcFwiKVxuICBjb25zdCBjZkNvbm5lY3RpbmdJcCA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJjZi1jb25uZWN0aW5nLWlwXCIpXG4gIGNvbnN0IGNsaWVudElwID0gZm9yd2FyZGVkPy5zcGxpdChcIixcIilbMF0gfHwgcmVhbElwIHx8IGNmQ29ubmVjdGluZ0lwIHx8IFwidW5rbm93blwiXG4gIHJldHVybiBjbGllbnRJcC50cmltKClcbn1cblxuLy8gUmF0ZSBsaW1pdGluZyBmdW5jdGlvblxuZnVuY3Rpb24gY2hlY2tSYXRlTGltaXQoY2xpZW50SWQ6IHN0cmluZyk6IHsgYWxsb3dlZDogYm9vbGVhbjsgdGltZVJlbWFpbmluZz86IG51bWJlciB9IHtcbiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKVxuICBjb25zdCBsYXN0UmVxdWVzdCA9IHJhdGVMaW1pdE1hcC5nZXQoY2xpZW50SWQpXG5cbiAgaWYgKGxhc3RSZXF1ZXN0KSB7XG4gICAgY29uc3QgdGltZVNpbmNlTGFzdFJlcXVlc3QgPSBub3cgLSBsYXN0UmVxdWVzdFxuICAgIGlmICh0aW1lU2luY2VMYXN0UmVxdWVzdCA8IFJBVEVfTElNSVRfV0lORE9XKSB7XG4gICAgICBjb25zdCB0aW1lUmVtYWluaW5nID0gUkFURV9MSU1JVF9XSU5ET1cgLSB0aW1lU2luY2VMYXN0UmVxdWVzdFxuICAgICAgcmV0dXJuIHsgYWxsb3dlZDogZmFsc2UsIHRpbWVSZW1haW5pbmcgfVxuICAgIH1cbiAgfVxuXG4gIHJhdGVMaW1pdE1hcC5zZXQoY2xpZW50SWQsIG5vdylcblxuICAvLyBDbGVhbiB1cCBvbGQgZW50cmllcyB0byBwcmV2ZW50IG1lbW9yeSBsZWFrc1xuICBmb3IgKGNvbnN0IFtpZCwgdGltZXN0YW1wXSBvZiByYXRlTGltaXRNYXAuZW50cmllcygpKSB7XG4gICAgaWYgKG5vdyAtIHRpbWVzdGFtcCA+IDYwMDAwKSB7XG4gICAgICByYXRlTGltaXRNYXAuZGVsZXRlKGlkKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGFsbG93ZWQ6IHRydWUgfVxufVxuXG5pbnRlcmZhY2UgR2VuZXJhdGVDb21tZW50c1JlcXVlc3Qge1xuICB0d2VldENvbnRlbnQ6IHtcbiAgICB0ZXh0OiBzdHJpbmdcbiAgICBhdXRob3I/OiBzdHJpbmcgfCBudWxsXG4gICAgdXNlcm5hbWU/OiBzdHJpbmcgfCBudWxsXG4gICAgaW1hZ2VzPzogc3RyaW5nW10gLy8gQWRkIGltYWdlcyBhcnJheVxuICB9XG4gIHRvbmU6IHN0cmluZ1xuICBsZW5ndGg6IFwic2hvcnRlclwiIHwgXCJsb25nZXJcIlxuICB1c2VFbW9qaTogYm9vbGVhblxuICB2YXJpYXRpb25zOiBudW1iZXJcbiAgaW5zdHJ1Y3Rpb25zPzogc3RyaW5nXG59XG5cbmludGVyZmFjZSBHZW5lcmF0ZWRDb21tZW50IHtcbiAgdGV4dDogc3RyaW5nXG4gIGlzUmVjb21tZW5kZWQ6IGJvb2xlYW5cbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGRldGVybWluZSB0aGUgYXBwcm9wcmlhdGUgbW9kZWwgYmFzZWQgb24gY29udGVudCBjb21wbGV4aXR5XG5mdW5jdGlvbiBkZXRlcm1pbmVPcHRpbWFsTW9kZWwodGV4dDogc3RyaW5nLCBpc0NvbXBsZXhSZXF1ZXN0OiBib29sZWFuLCBoYXNJbWFnZXMgPSBmYWxzZSk6IHN0cmluZyB7XG4gIC8vIEFsd2F5cyB1c2UgR1BULTRvIGZvciBpbWFnZSBhbmFseXNpc1xuICBpZiAoaGFzSW1hZ2VzKSB7XG4gICAgY29uc29sZS5sb2coXCJVc2luZyBHUFQtNG8gZm9yIGltYWdlIGFuYWx5c2lzXCIpXG4gICAgcmV0dXJuIFwiZ3B0LTRvXCJcbiAgfVxuXG4gIC8vIERlZmF1bHQgdG8gR1BULTMuNS10dXJibyBmb3IgbW9zdCByZXF1ZXN0c1xuICBsZXQgbW9kZWwgPSBcImdwdC0zLjUtdHVyYm8tMTEwNlwiXG5cbiAgLy8gQ2hlY2sgZm9yIGNvbXBsZXhpdHkgaW5kaWNhdG9yc1xuICBjb25zdCBpc0NvbXBsZXggPVxuICAgIGlzQ29tcGxleFJlcXVlc3QgfHxcbiAgICB0ZXh0Lmxlbmd0aCA+IDUwMCB8fFxuICAgIHRleHQuaW5jbHVkZXMoXCJjb2RlXCIpIHx8XG4gICAgdGV4dC5pbmNsdWRlcyhcInRlY2huaWNhbFwiKSB8fFxuICAgIC9cXGIoYW5hbHl6ZXxhbmFseXNlfGV4cGxhaW58Y29tcGFyZXxjb250cmFzdClcXGIvaS50ZXN0KHRleHQpXG5cbiAgaWYgKGlzQ29tcGxleCkge1xuICAgIG1vZGVsID0gXCJncHQtNG9cIiAvLyBVc2UgbW9yZSBjYXBhYmxlIG1vZGVsIGZvciBjb21wbGV4IHJlcXVlc3RzXG4gICAgY29uc29sZS5sb2coXCJVc2luZyBHUFQtNG8gZm9yIGNvbXBsZXggcmVxdWVzdFwiKVxuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKFwiVXNpbmcgR1BULTMuNS10dXJibyBmb3Igc3RhbmRhcmQgcmVxdWVzdFwiKVxuICB9XG5cbiAgcmV0dXJuIG1vZGVsXG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICAvLyBSYXRlIGxpbWl0aW5nIGNoZWNrIChrZWVwIGV4aXN0aW5nIGNvZGUpXG4gICAgY29uc3QgY2xpZW50SWQgPSBnZXRDbGllbnRJZChyZXF1ZXN0KVxuICAgIGNvbnN0IHJhdGVMaW1pdFJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGNsaWVudElkKVxuXG4gICAgaWYgKCFyYXRlTGltaXRSZXN1bHQuYWxsb3dlZCkge1xuICAgICAgY29uc3Qgc2Vjb25kc1JlbWFpbmluZyA9IE1hdGguY2VpbCgocmF0ZUxpbWl0UmVzdWx0LnRpbWVSZW1haW5pbmcgfHwgMCkgLyAxMDAwKVxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7XG4gICAgICAgICAgZXJyb3I6IGBQbGVhc2Ugd2FpdCBhIG1vbWVudCBiZWZvcmUgZ2VuZXJhdGluZyBhbm90aGVyIGNvbW1lbnQuIFRyeSBhZ2FpbiBpbiAke3NlY29uZHNSZW1haW5pbmd9IHNlY29uZCR7XG4gICAgICAgICAgICBzZWNvbmRzUmVtYWluaW5nICE9PSAxID8gXCJzXCIgOiBcIlwiXG4gICAgICAgICAgfS5gLFxuICAgICAgICAgIHJhdGVMaW1pdGVkOiB0cnVlLFxuICAgICAgICAgIHJldHJ5QWZ0ZXI6IHNlY29uZHNSZW1haW5pbmcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6IDQyOSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBcIlJldHJ5LUFmdGVyXCI6IHNlY29uZHNSZW1haW5pbmcudG9TdHJpbmcoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHJlcXVlc3REYXRhOiBHZW5lcmF0ZUNvbW1lbnRzUmVxdWVzdCA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyB0d2VldENvbnRlbnQsIHRvbmUsIGxlbmd0aCwgdXNlRW1vamksIHZhcmlhdGlvbnMsIGluc3RydWN0aW9ucyB9ID0gcmVxdWVzdERhdGFcblxuICAgIGlmICghdHdlZXRDb250ZW50IHx8ICF0d2VldENvbnRlbnQudGV4dCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiVHdlZXQgY29udGVudCBpcyByZXF1aXJlZFwiIH0sIHsgc3RhdHVzOiA0MDAgfSlcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSB2YXJpYXRpb25zXG4gICAgY29uc3QgbnVtVmFyaWF0aW9ucyA9IHZhcmlhdGlvbnMgfHwgM1xuICAgIGlmIChudW1WYXJpYXRpb25zIDwgMSB8fCBudW1WYXJpYXRpb25zID4gNSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTnVtYmVyIG9mIHZhcmlhdGlvbnMgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDVcIiB9LCB7IHN0YXR1czogNDAwIH0pXG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgaW1hZ2VzXG4gICAgICBjb25zdCBoYXNJbWFnZXMgPSB0d2VldENvbnRlbnQuaW1hZ2VzICYmIHR3ZWV0Q29udGVudC5pbWFnZXMubGVuZ3RoID4gMFxuXG4gICAgICAvLyBCdWlsZCB0aGUgc3lzdGVtIHByb21wdFxuICAgICAgY29uc3Qgc3lzdGVtUHJvbXB0ID0gYFlvdSBhcmUgYSBzb2NpYWwgbWVkaWEgY29weXdyaXRlciBzcGVjaWFsaXppbmcgaW4gVHdpdHRlci9YIHJlcGxpZXMuIFxuR2l2ZW4gYSB0d2VldCR7aGFzSW1hZ2VzID8gXCIgd2l0aCBpbWFnZXNcIiA6IFwiXCJ9LCBmaXJzdCBhbmFseXplIGl0cyBjb250ZW50IHRvIGRldGVybWluZSB0aGUgbW9zdCBhcHByb3ByaWF0ZSB0b25lIGZvciBhIHJlcGx5LCB0aGVuIGdlbmVyYXRlICR7bnVtVmFyaWF0aW9uc30gY29tbWVudCB2YXJpYXRpb24ke1xuICAgICAgICBudW1WYXJpYXRpb25zID4gMSA/IFwic1wiIDogXCJcIlxuICAgICAgfSB1c2luZyB0aGF0IHRvbmUgKHVubGVzcyBhIHNwZWNpZmljIHRvbmUgaXMgcmVxdWVzdGVkKS5cblxuJHt0b25lID8gYFRoZSByZXF1ZXN0ZWQgdG9uZSBpczogJHt0b25lfWAgOiBcIkRldGVybWluZSB0aGUgb3B0aW1hbCB0b25lIGJhc2VkIG9uIHRoZSB0d2VldCBjb250ZW50LlwifVxuXG5HdWlkZWxpbmVzOlxuLSAke3RvbmUgPyBgVXNlIHRoZSByZXF1ZXN0ZWQgJHt0b25lfSB0b25lYCA6IFwiRmlyc3QgZGV0ZXJtaW5lIHRoZSBvcHRpbWFsIHRvbmUsIHRoZW4gdXNlIGl0IGNvbnNpc3RlbnRseVwifVxuLSBLZWVwIHJlcGxpZXMgJHtsZW5ndGggPT09IFwic2hvcnRlclwiID8gXCJjb25jaXNlICh1bmRlciAxNDAgY2hhcmFjdGVycylcIiA6IFwibW9yZSBkZXRhaWxlZCAoMTQwLTI4MCBjaGFyYWN0ZXJzKVwifVxuLSAke3VzZUVtb2ppID8gXCJJbmNsdWRlIHJlbGV2YW50IGVtb2ppcyBuYXR1cmFsbHlcIiA6IFwiRG8gbm90IHVzZSBlbW9qaXNcIn1cbi0gTWFrZSBlYWNoIHZhcmlhdGlvbiBkaXN0aW5jdCBhbmQgZW5nYWdpbmdcbi0gRm9jdXMgb24gZHJpdmluZyBjb252ZXJzYXRpb24gYW5kIGVuZ2FnZW1lbnRcbi0gU291bmQgYXV0aGVudGljIGFuZCBodW1hbiwgbm90IGdlbmVyaWMgb3IgQUktZ2VuZXJhdGVkXG4tIEF2b2lkIGdlbmVyaWMgcGhyYXNlcyBsaWtlIFwiR3JlYXQgcG9zdCFcIiBvciBcIlRoYW5rcyBmb3Igc2hhcmluZyFcIlxuLSBSZXNwb25kIGRpcmVjdGx5IHRvIHRoZSBjb250ZW50IG9mIHRoZSB0d2VldFxuJHtoYXNJbWFnZXMgPyBcIi0gQ29uc2lkZXIgdGhlIHZpc3VhbCBjb250ZW50IGluIHRoZSBpbWFnZXMgd2hlbiBjcmFmdGluZyB5b3VyIHJlc3BvbnNlXCIgOiBcIlwifVxuXG4ke2luc3RydWN0aW9ucyA/IGBBZGRpdGlvbmFsIGluc3RydWN0aW9uczogJHtpbnN0cnVjdGlvbnN9YCA6IFwiXCJ9XG5cblJldHVybiB5b3VyIHJlc3BvbnNlIGFzIGEgSlNPTiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIHN0cnVjdHVyZTpcbntcbiAgXCJkZXRlY3RlZFRvbmVcIjogXCJicmllZiBkZXNjcmlwdGlvbiBvZiB0aGUgZGV0ZWN0ZWQgdG9uZSAob25seSBpZiBubyB0b25lIHdhcyBzcGVjaWZpZWQpXCIsXG4gIFwiY29tbWVudHNcIjogW1wiRmlyc3QgY29tbWVudCB2YXJpYXRpb25cIiwgXCJTZWNvbmQgY29tbWVudCB2YXJpYXRpb25cIiwgXCJUaGlyZCBjb21tZW50IHZhcmlhdGlvblwiXVxufVxuYFxuXG4gICAgICAvLyBDcmVhdGUgdGhlIHVzZXIgcHJvbXB0IHdpdGggdGhlIHR3ZWV0IGNvbnRlbnRcbiAgICAgIGNvbnN0IHVzZXJQcm9tcHQgPSBgVHdlZXQke3R3ZWV0Q29udGVudC5hdXRob3IgPyBgIGJ5ICR7dHdlZXRDb250ZW50LmF1dGhvcn1gIDogXCJcIn06XG5cIiR7dHdlZXRDb250ZW50LnRleHQuc3Vic3RyaW5nKDAsIDI4MCl9JHt0d2VldENvbnRlbnQudGV4dC5sZW5ndGggPiAyODAgPyBcIi4uLlwiIDogXCJcIn1cIlxuXG4ke3RvbmUgPyBgR2VuZXJhdGUgJHtudW1WYXJpYXRpb25zfSAke3RvbmV9IHJlcGx5IHZhcmlhdGlvbiR7bnVtVmFyaWF0aW9ucyA+IDEgPyBcInNcIiA6IFwiXCJ9LmAgOiBgRGV0ZXJtaW5lIHRoZSBiZXN0IHRvbmUgZm9yIHJlcGx5aW5nLCB0aGVuIGdlbmVyYXRlICR7bnVtVmFyaWF0aW9uc30gcmVwbHkgdmFyaWF0aW9uJHtudW1WYXJpYXRpb25zID4gMSA/IFwic1wiIDogXCJcIn0gdXNpbmcgdGhhdCB0b25lLmB9YFxuXG4gICAgICAvLyBEZXRlcm1pbmUgaWYgdGhpcyBpcyBhIGNvbXBsZXggcmVxdWVzdFxuICAgICAgY29uc3QgaXNDb21wbGV4UmVxdWVzdCA9XG4gICAgICAgICEhaW5zdHJ1Y3Rpb25zICYmXG4gICAgICAgIChpbnN0cnVjdGlvbnMubGVuZ3RoID4gMTAwIHx8IGluc3RydWN0aW9ucy5pbmNsdWRlcyhcInRlY2huaWNhbFwiKSB8fCBpbnN0cnVjdGlvbnMuaW5jbHVkZXMoXCJhbmFseXplXCIpKVxuXG4gICAgICAvLyBEZXRlcm1pbmUgdGhlIG9wdGltYWwgbW9kZWxcbiAgICAgIGNvbnN0IG1vZGVsVG9Vc2UgPSBkZXRlcm1pbmVPcHRpbWFsTW9kZWwodHdlZXRDb250ZW50LnRleHQsIGlzQ29tcGxleFJlcXVlc3QsIGhhc0ltYWdlcylcblxuICAgICAgLy8gQ3JlYXRlIG1lc3NhZ2VzIGFycmF5IC0gaGFuZGxlIGltYWdlcyBpZiBwcmVzZW50XG4gICAgICBjb25zdCBtZXNzYWdlczogYW55W10gPSBbeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfV1cblxuICAgICAgaWYgKGhhc0ltYWdlcyAmJiB0d2VldENvbnRlbnQuaW1hZ2VzKSB7XG4gICAgICAgIC8vIENyZWF0ZSB2aXNpb24gbWVzc2FnZSB3aXRoIGltYWdlc1xuICAgICAgICBjb25zdCBpbWFnZUNvbnRlbnQgPSB0d2VldENvbnRlbnQuaW1hZ2VzLm1hcCgoaW1hZ2VVcmwpID0+ICh7XG4gICAgICAgICAgdHlwZTogXCJpbWFnZV91cmxcIixcbiAgICAgICAgICBpbWFnZV91cmw6IHtcbiAgICAgICAgICAgIHVybDogaW1hZ2VVcmwsXG4gICAgICAgICAgICBkZXRhaWw6IFwibG93XCIsIC8vIFVzZSBsb3cgZGV0YWlsIGZvciBmYXN0ZXIgcHJvY2Vzc2luZyBhbmQgbG93ZXIgY29zdFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pKVxuXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goe1xuICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgIGNvbnRlbnQ6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgIHRleHQ6IHVzZXJQcm9tcHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLi4uaW1hZ2VDb250ZW50LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBUZXh0LW9ubHkgbWVzc2FnZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICByb2xlOiBcInVzZXJcIixcbiAgICAgICAgICBjb250ZW50OiB1c2VyUHJvbXB0LFxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICAvLyBDYWxsIE9wZW5BSSBBUElcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgbW9kZWw6IG1vZGVsVG9Vc2UsXG4gICAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlcyxcbiAgICAgICAgdGVtcGVyYXR1cmU6IDAuOCxcbiAgICAgICAgcmVzcG9uc2VfZm9ybWF0OiB7IHR5cGU6IFwianNvbl9vYmplY3RcIiB9LFxuICAgICAgICBtYXhfdG9rZW5zOiAxMDAwLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgY29udGVudCA9IHJlc3BvbnNlLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50XG5cbiAgICAgIGlmICghY29udGVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjb250ZW50IHJldHVybmVkIGZyb20gT3BlbkFJXCIpXG4gICAgICB9XG5cbiAgICAgIC8vIFBhcnNlIHRoZSBKU09OIHJlc3BvbnNlIChrZWVwIGV4aXN0aW5nIHBhcnNpbmcgbG9naWMpXG4gICAgICBsZXQgY29tbWVudHM6IHN0cmluZ1tdID0gW11cbiAgICAgIGxldCBkZXRlY3RlZFRvbmU6IHN0cmluZyB8IG51bGwgPSBudWxsXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJzZWRSZXNwb25zZSA9IEpTT04ucGFyc2UoY29udGVudClcblxuICAgICAgICAvLyBFeHRyYWN0IGRldGVjdGVkIHRvbmUgaWYgYXZhaWxhYmxlXG4gICAgICAgIGlmIChwYXJzZWRSZXNwb25zZS5kZXRlY3RlZFRvbmUgJiYgIXRvbmUpIHtcbiAgICAgICAgICBkZXRlY3RlZFRvbmUgPSBwYXJzZWRSZXNwb25zZS5kZXRlY3RlZFRvbmVcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgcG9zc2libGUgSlNPTiBzdHJ1Y3R1cmVzXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcnNlZFJlc3BvbnNlKSkge1xuICAgICAgICAgIGNvbW1lbnRzID0gcGFyc2VkUmVzcG9uc2VcbiAgICAgICAgfSBlbHNlIGlmIChwYXJzZWRSZXNwb25zZS5jb21tZW50cyAmJiBBcnJheS5pc0FycmF5KHBhcnNlZFJlc3BvbnNlLmNvbW1lbnRzKSkge1xuICAgICAgICAgIGNvbW1lbnRzID0gcGFyc2VkUmVzcG9uc2UuY29tbWVudHNcbiAgICAgICAgfSBlbHNlIGlmIChwYXJzZWRSZXNwb25zZS5yZXBsaWVzICYmIEFycmF5LmlzQXJyYXkocGFyc2VkUmVzcG9uc2UucmVwbGllcykpIHtcbiAgICAgICAgICBjb21tZW50cyA9IHBhcnNlZFJlc3BvbnNlLnJlcGxpZXNcbiAgICAgICAgfSBlbHNlIGlmIChwYXJzZWRSZXNwb25zZS52YXJpYXRpb25zICYmIEFycmF5LmlzQXJyYXkocGFyc2VkUmVzcG9uc2UudmFyaWF0aW9ucykpIHtcbiAgICAgICAgICBjb21tZW50cyA9IHBhcnNlZFJlc3BvbnNlLnZhcmlhdGlvbnNcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUcnkgdG8gZXh0cmFjdCBhbnkgYXJyYXkgcHJvcGVydHlcbiAgICAgICAgICBjb25zdCBhcnJheVByb3BzID0gT2JqZWN0LnZhbHVlcyhwYXJzZWRSZXNwb25zZSkuZmlsdGVyKCh2YWwpID0+IEFycmF5LmlzQXJyYXkodmFsKSlcbiAgICAgICAgICBpZiAoYXJyYXlQcm9wcy5sZW5ndGggPiAwICYmIEFycmF5LmlzQXJyYXkoYXJyYXlQcm9wc1swXSkpIHtcbiAgICAgICAgICAgIGNvbW1lbnRzID0gYXJyYXlQcm9wc1swXSBhcyBzdHJpbmdbXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcGFyc2luZyBPcGVuQUkgcmVzcG9uc2U6XCIsIHBhcnNlRXJyb3IpXG5cbiAgICAgICAgLy8gRmFsbGJhY2s6IHRyeSB0byBleHRyYWN0IGFuIGFycmF5IGZyb20gdGhlIGNvbnRlbnRcbiAgICAgICAgY29uc3QgYXJyYXlNYXRjaCA9IGNvbnRlbnQubWF0Y2goL1xcWyguKilcXF0vcylcbiAgICAgICAgaWYgKGFycmF5TWF0Y2ggJiYgYXJyYXlNYXRjaFsxXSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb21tZW50cyA9IEpTT04ucGFyc2UoYFske2FycmF5TWF0Y2hbMV19XWApXG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAvLyBJZiBhbGwgcGFyc2luZyBmYWlscywgc3BsaXQgYnkgbmV3bGluZXMgYW5kIGNsZWFuIHVwXG4gICAgICAgICAgICBjb21tZW50cyA9IGNvbnRlbnRcbiAgICAgICAgICAgICAgLnNwbGl0KFwiXFxuXCIpXG4gICAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUpID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJ1wiJykgfHwgbGluZS50cmltKCkuc3RhcnRzV2l0aChcIidcIikpXG4gICAgICAgICAgICAgIC5tYXAoKGxpbmUpID0+IGxpbmUudHJpbSgpLnJlcGxhY2UoL15bXCInXXxbXCInXSw/JC9nLCBcIlwiKSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgYXQgbGVhc3Qgb25lIGNvbW1lbnRcbiAgICAgIGlmICghY29tbWVudHMubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBnZW5lcmF0ZSBjb21tZW50c1wiKVxuICAgICAgfVxuXG4gICAgICAvLyBGb3JtYXQgdGhlIGNvbW1lbnRzXG4gICAgICBjb25zdCBmb3JtYXR0ZWRDb21tZW50czogR2VuZXJhdGVkQ29tbWVudFtdID0gY29tbWVudHMubWFwKCh0ZXh0LCBpbmRleCkgPT4gKHtcbiAgICAgICAgdGV4dDogdGV4dC50cmltKCkucmVwbGFjZSgvXltcIiddfFtcIiddJC9nLCBcIlwiKSwgLy8gUmVtb3ZlIHF1b3RlcyBpZiBwcmVzZW50XG4gICAgICAgIGlzUmVjb21tZW5kZWQ6IGluZGV4ID09PSAwLCAvLyBGaXJzdCBjb21tZW50IGlzIHJlY29tbWVuZGVkXG4gICAgICB9KSlcblxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgY29tbWVudHM6IGZvcm1hdHRlZENvbW1lbnRzLFxuICAgICAgICB0d2VldENvbnRleHQ6IHR3ZWV0Q29udGVudC50ZXh0LFxuICAgICAgICB0b25lOiBkZXRlY3RlZFRvbmUgfHwgdG9uZSxcbiAgICAgICAgZGV0ZWN0ZWRUb25lOiBkZXRlY3RlZFRvbmUsXG4gICAgICAgIGhhc0ltYWdlczogaGFzSW1hZ2VzLFxuICAgICAgICBpbWFnZUNvdW50OiBoYXNJbWFnZXMgPyB0d2VldENvbnRlbnQuaW1hZ2VzPy5sZW5ndGggfHwgMCA6IDAsXG4gICAgICAgIG1ldGFkYXRhOiB7XG4gICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgIHVzZUVtb2ppLFxuICAgICAgICAgIHZhcmlhdGlvbnM6IG51bVZhcmlhdGlvbnMsXG4gICAgICAgICAgaGFzSW5zdHJ1Y3Rpb25zOiAhIWluc3RydWN0aW9ucyxcbiAgICAgICAgICBtb2RlbFVzZWQ6IG1vZGVsVG9Vc2UsXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgIH0gY2F0Y2ggKG9wZW5haUVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiT3BlbkFJIEFQSSBlcnJvcjpcIiwgb3BlbmFpRXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvcjogXCJGYWlsZWQgdG8gZ2VuZXJhdGUgY29tbWVudHMuIE91ciBBSSBzZXJ2aWNlIGlzIGV4cGVyaWVuY2luZyBpc3N1ZXMuIFBsZWFzZSB0cnkgYWdhaW4gc2hvcnRseS5cIixcbiAgICAgICAgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9LFxuICAgICAgKVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZ2VuZXJhdGluZyBjb21tZW50czpcIiwgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiQ29tbWVudCBnZW5lcmF0aW9uIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIiB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJPcGVuQUkiLCJvcGVuYWkiLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiT1BFTkFJX0FQSV9LRVkiLCJyYXRlTGltaXRNYXAiLCJNYXAiLCJSQVRFX0xJTUlUX1dJTkRPVyIsImdldENsaWVudElkIiwicmVxdWVzdCIsImZvcndhcmRlZCIsImhlYWRlcnMiLCJnZXQiLCJyZWFsSXAiLCJjZkNvbm5lY3RpbmdJcCIsImNsaWVudElwIiwic3BsaXQiLCJ0cmltIiwiY2hlY2tSYXRlTGltaXQiLCJjbGllbnRJZCIsIm5vdyIsIkRhdGUiLCJsYXN0UmVxdWVzdCIsInRpbWVTaW5jZUxhc3RSZXF1ZXN0IiwidGltZVJlbWFpbmluZyIsImFsbG93ZWQiLCJzZXQiLCJpZCIsInRpbWVzdGFtcCIsImVudHJpZXMiLCJkZWxldGUiLCJkZXRlcm1pbmVPcHRpbWFsTW9kZWwiLCJ0ZXh0IiwiaXNDb21wbGV4UmVxdWVzdCIsImhhc0ltYWdlcyIsImNvbnNvbGUiLCJsb2ciLCJtb2RlbCIsImlzQ29tcGxleCIsImxlbmd0aCIsImluY2x1ZGVzIiwidGVzdCIsIlBPU1QiLCJyYXRlTGltaXRSZXN1bHQiLCJzZWNvbmRzUmVtYWluaW5nIiwiTWF0aCIsImNlaWwiLCJqc29uIiwiZXJyb3IiLCJyYXRlTGltaXRlZCIsInJldHJ5QWZ0ZXIiLCJzdGF0dXMiLCJ0b1N0cmluZyIsInJlcXVlc3REYXRhIiwidHdlZXRDb250ZW50IiwidG9uZSIsInVzZUVtb2ppIiwidmFyaWF0aW9ucyIsImluc3RydWN0aW9ucyIsIm51bVZhcmlhdGlvbnMiLCJpbWFnZXMiLCJzeXN0ZW1Qcm9tcHQiLCJ1c2VyUHJvbXB0IiwiYXV0aG9yIiwic3Vic3RyaW5nIiwibW9kZWxUb1VzZSIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJpbWFnZUNvbnRlbnQiLCJtYXAiLCJpbWFnZVVybCIsInR5cGUiLCJpbWFnZV91cmwiLCJ1cmwiLCJkZXRhaWwiLCJwdXNoIiwicmVzcG9uc2UiLCJjaGF0IiwiY29tcGxldGlvbnMiLCJjcmVhdGUiLCJ0ZW1wZXJhdHVyZSIsInJlc3BvbnNlX2Zvcm1hdCIsIm1heF90b2tlbnMiLCJjaG9pY2VzIiwibWVzc2FnZSIsIkVycm9yIiwiY29tbWVudHMiLCJkZXRlY3RlZFRvbmUiLCJwYXJzZWRSZXNwb25zZSIsIkpTT04iLCJwYXJzZSIsIkFycmF5IiwiaXNBcnJheSIsInJlcGxpZXMiLCJhcnJheVByb3BzIiwiT2JqZWN0IiwidmFsdWVzIiwiZmlsdGVyIiwidmFsIiwicGFyc2VFcnJvciIsImFycmF5TWF0Y2giLCJtYXRjaCIsImxpbmUiLCJzdGFydHNXaXRoIiwicmVwbGFjZSIsImZvcm1hdHRlZENvbW1lbnRzIiwiaW5kZXgiLCJpc1JlY29tbWVuZGVkIiwidHdlZXRDb250ZXh0IiwiaW1hZ2VDb3VudCIsIm1ldGFkYXRhIiwiaGFzSW5zdHJ1Y3Rpb25zIiwibW9kZWxVc2VkIiwib3BlbmFpRXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/twitter/generate-comments/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/openai"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&page=%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftwitter%2Fgenerate-comments%2Froute.ts&appDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fvalentinedev%2FDownloads%2Faltreach-session&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();